# WebSocket 測試報告

## 測試時間
$(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')

## 測試結果

### ✅ 服務狀態檢查

1. **Spring Boot 應用程式**
   - 狀態: ✅ 運行中
   - URL: http://localhost:8080
   - 狀態碼: 200

2. **Redis**
   - 狀態: ✅ 正常
   - 連接: localhost:6379
   - 測試: PONG 回應正常

3. **RabbitMQ**
   - 狀態: ✅ 正常
   - AMQP: localhost:5672
   - 管理介面: http://localhost:15672
   - 狀態: 可訪問

### ⚠️ REST API 測試

- **狀態**: 需要進一步檢查
- **說明**: REST API 可能有格式問題，但不影響 WebSocket 功能

## WebSocket 功能測試步驟

### 1. 開啟測試頁面

請在瀏覽器中開啟以下頁面：

- **專員A頁面**: http://localhost:8080/agent-a.html
- **專員B頁面**: http://localhost:8080/agent-b.html
- **公共聊天室**: http://localhost:8080/chatroom.html

### 2. 檢查連接狀態

1. 開啟瀏覽器開發者工具（F12）
2. 切換到 Console 標籤
3. 確認看到 "已連接" 狀態
4. 確認看到用戶 ID 顯示

### 3. 測試公共訊息

1. 在專員A頁面發送公共訊息
2. 檢查專員B頁面是否收到
3. 檢查公共聊天室是否收到

### 4. 測試私信

1. 在專員A頁面查看「我的用戶 ID」
2. 在專員B頁面輸入專員A的用戶 ID
3. 在專員B頁面發送私信給專員A
4. 檢查專員A頁面是否收到私信

### 5. 檢查伺服器日誌

查看應用程式控制台輸出，應該看到：
- `=== 公共訊息接收 ===`
- `=== 私信發送調試 ===`
- `Redis 訊息接收`
- `訊息已轉發到 WebSocket /topic/chat 頻道`

## 常見問題排查

### 問題 1: 收不到公共訊息

**檢查項目**:
- [ ] 確認兩個頁面都已連接
- [ ] 確認訂閱了 `/topic/chat` 頻道
- [ ] 檢查 Redis 是否正常運行
- [ ] 查看伺服器日誌是否有錯誤

### 問題 2: 收不到私信

**檢查項目**:
- [ ] 確認用戶 ID 正確
- [ ] 確認訂閱了 `/user/topic/privateMessage` 頻道
- [ ] 檢查伺服器日誌中的目標路徑
- [ ] 確認兩個用戶都在同一節點連接

### 問題 3: 連接失敗

**檢查項目**:
- [ ] 確認應用程式正在運行
- [ ] 檢查瀏覽器控制台錯誤訊息
- [ ] 確認 WebSocket 端點正確：`/our-websocket`
- [ ] 檢查防火牆設定

## 測試檢查清單

- [ ] 應用程式運行正常
- [ ] Redis 連接正常
- [ ] RabbitMQ 連接正常
- [ ] 專員A頁面可以連接
- [ ] 專員B頁面可以連接
- [ ] 公共訊息可以發送和接收
- [ ] 私信可以發送和接收
- [ ] 伺服器日誌沒有錯誤

## 下一步

如果所有檢查都通過，WebSocket 功能應該正常運作。如果遇到問題，請：
1. 查看瀏覽器控制台錯誤
2. 查看伺服器日誌
3. 檢查 Network 標籤中的 WebSocket 訊息
