# 專員A和專員B私信測試指南

## 測試目標
驗證專員A和專員B之間可以互相發送私信。

## 方法一：瀏覽器測試（推薦）

### 步驟

1. **確保應用程式正在運行**
   ```powershell
   # 檢查應用程式是否運行
   netstat -ano | findstr ":8080"
   ```

2. **打開兩個瀏覽器窗口（或使用無痕模式）**

   - **窗口1（專員A）**：打開 `http://localhost:8080/agent-a.html`
   - **窗口2（專員B）**：打開 `http://localhost:8080/agent-b.html`

3. **等待連接建立**
   - 兩個頁面都應該顯示「已連接」狀態
   - 專員A頁面會顯示專員B的ID和狀態
   - 專員B頁面會顯示專員A的ID和狀態

4. **測試私信功能**

   **從專員A發送給專員B：**
   - 在專員A頁面的「私信」區域
   - 輸入訊息內容
   - 點擊「發送私信」按鈕
   - 檢查專員B頁面是否收到訊息

   **從專員B發送給專員A：**
   - 在專員B頁面的「私信」區域
   - 輸入訊息內容
   - 點擊「發送私信」按鈕
   - 檢查專員A頁面是否收到訊息

5. **驗證結果**
   - ✓ 專員A發送的訊息應該出現在專員B的訊息區域（橙色邊框）
   - ✓ 專員B發送的訊息應該出現在專員A的訊息區域（橙色邊框）
   - ✓ 雙方都能看到對方的訊息

## 方法二：自動化測試腳本

### 執行測試腳本

```powershell
cd tests\javascript
node 專員A和B雙向私信測試.js
```

### 測試腳本功能

- 自動建立專員A和專員B的 WebSocket 連接
- 自動訂閱私信頻道
- 自動發送測試訊息（專員A → 專員B，專員B → 專員A）
- 自動驗證訊息是否正確送達
- 輸出詳細的測試結果

### 預期輸出

```
========================================
  專員A和專員B雙向私信測試
========================================
測試目標：驗證專員A和專員B可以互相發送私信

步驟1：建立專員A連接...
[專員A] ✓ 連接成功！
[專員A] 用戶ID: abc123...

步驟2：建立專員B連接...
[專員B] ✓ 連接成功！
[專員B] 用戶ID: def456...

步驟3：專員A訂閱私信頻道...
[專員A] ✓ 已訂閱 /user/topic/privateMessage

步驟4：專員B訂閱私信頻道...
[專員B] ✓ 已訂閱 /user/topic/privateMessage

步驟6：專員A發送私信給專員B...
[專員A] ✓ 私信已發送
[專員B] ✓ 收到私信！

步驟7：專員B發送私信給專員A...
[專員B] ✓ 私信已發送
[專員A] ✓ 收到私信！

✓ 測試通過！專員A和專員B可以互相發送私信！
```

## 故障排除

### 問題1：應用程式未運行

**解決方案：**
```powershell
# 啟動應用程式
mvn spring-boot:run
```

### 問題2：連接失敗

**檢查項目：**
- Redis 是否運行：`docker ps | findstr redis`
- RabbitMQ 是否運行：`docker ps | findstr rabbitmq`
- 應用程式日誌是否有錯誤

### 問題3：私信無法送達

**檢查項目：**
1. 確認雙方都已連接（頁面顯示「已連接」）
2. 確認雙方都已訂閱私信頻道（檢查瀏覽器控制台）
3. 確認接收者ID正確（檢查頁面顯示的目標專員ID）
4. 檢查應用程式日誌，查看是否有私信處理的記錄

### 問題4：測試腳本連接失敗

**可能原因：**
- 應用程式未啟動
- 端口 8080 被佔用
- 網路連接問題

**解決方案：**
```powershell
# 檢查應用程式狀態
Invoke-WebRequest -Uri "http://localhost:8080" -UseBasicParsing -TimeoutSec 5

# 檢查端口
netstat -ano | findstr ":8080"
```

## 測試檢查清單

- [ ] 應用程式正在運行（端口 8080）
- [ ] Redis 容器正在運行
- [ ] RabbitMQ 容器正在運行
- [ ] 專員A頁面可以打開並連接
- [ ] 專員B頁面可以打開並連接
- [ ] 專員A可以發送私信給專員B
- [ ] 專員B可以收到專員A的私信
- [ ] 專員B可以發送私信給專員A
- [ ] 專員A可以收到專員B的私信
- [ ] 雙方都能看到對方的訊息

## 相關文件

- `tests/javascript/專員A和B雙向私信測試.js` - 自動化測試腳本
- `src/main/resources/static/agent-a.html` - 專員A測試頁面
- `src/main/resources/static/agent-b.html` - 專員B測試頁面

